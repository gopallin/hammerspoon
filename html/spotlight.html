<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    :root {
      --bg: rgba(255, 255, 255, 0.8);
      --border: rgba(0, 0, 0, 0.08);
      --text: #1c1c1e;
      --subtext: #6e6e73;
      --highlight: rgba(0, 122, 255, 0.18);
      --highlight-strong: #0a84ff;
      --pill: rgba(0, 0, 0, 0.06);
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", Helvetica, Arial, sans-serif;
      color: var(--text);
      height: 100%;
    }
    .panel {
      width: 100%;
      height: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px 12px 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      backdrop-filter: blur(18px) saturate(140%);
    }
    .topbar {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .search {
      width: 100%;
      border: 0;
      outline: none;
      background: transparent;
      font-size: 18px;
      line-height: 24px;
      padding: 6px 6px;
      flex: 1;
    }
    .modes {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px;
      border-radius: 10px;
      background: var(--pill);
      font-size: 12px;
      line-height: 16px;
    }
    .mode {
      padding: 4px 8px;
      border-radius: 8px;
      color: var(--subtext);
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 28px;
      min-height: 22px;
    }
    .mode.active {
      color: var(--text);
      background: rgba(255, 255, 255, 0.7);
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.06);
    }
    .mode-icon {
      width: 16px;
      height: 16px;
      object-fit: contain;
      opacity: 0.9;
    }
    .list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow: auto;
      padding-right: 4px;
    }
    .item {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 10px;
    }
    .icon {
      width: 16px;
      height: 16px;
      flex: 0 0 16px;
      border-radius: 3px;
      background: rgba(0, 0, 0, 0.06);
      object-fit: contain;
    }
    .meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
      flex: 1;
    }
    .item.active {
      background: var(--highlight);
      outline: 1px solid rgba(10, 132, 255, 0.3);
    }
    .title {
      font-size: 14px;
      line-height: 18px;
    }
    .sub {
      font-size: 12px;
      line-height: 16px;
      color: var(--subtext);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .hint {
      font-size: 14px;
      line-height: 18px;
      font-weight: 600;
      color: var(--text);
      opacity: 0.9;
      white-space: nowrap;
      margin-left: 12px;
    }
  </style>
</head>
<body>
  <div class="panel">
    <div class="topbar">
      <input id="search" class="search" type="text" placeholder="Search" autofocus autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false" />
      <div class="modes">
        <div class="mode active" data-mode="edge" title="Edge">
          <img class="mode-icon" src="https://www.google.com/s2/favicons?sz=32&domain=edge.microsoft.com" alt="Edge" />
        </div>
        <div class="mode" data-mode="ghostty" title="Ghostty">
          <img class="mode-icon" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><rect x='3' y='6' width='26' height='20' rx='4' fill='%231c1c1e'/><path d='M8 12l4 4-4 4' stroke='%23ffffff' stroke-width='2' fill='none' stroke-linecap='round' stroke-linejoin='round'/><rect x='15' y='18' width='7' height='2' rx='1' fill='%23ffffff'/></svg>" alt="Ghostty" />
        </div>
      </div>
    </div>
    <div id="list" class="list"></div>
  </div>

  <script>
    const data = __DATA__;
    const listEl = document.getElementById("list");
    const inputEl = document.getElementById("search");
    const modeEls = Array.from(document.querySelectorAll(".mode"));
    let mode = "edge";
    let items = data.edge || [];
    let filtered = items;
    let active = 0;

    function setMode(next) {
      mode = next;
      items = (mode === "ghostty") ? (data.ghostty || []) : (data.edge || []);
      filtered = items;
      active = 0;
      modeEls.forEach(el => el.classList.toggle("active", el.dataset.mode === mode));
      render();
    }

    function render() {
      listEl.innerHTML = "";
      if (filtered.length === 0) return;
      filtered.slice(0, 50).forEach((item, idx) => {
        const row = document.createElement("div");
        row.className = "item" + (idx === active ? " active" : "");
        const icon = document.createElement("img");
        icon.className = "icon";
        icon.alt = "";
        if (item.iconUrl) icon.src = item.iconUrl;
        const meta = document.createElement("div");
        meta.className = "meta";
        const title = document.createElement("div");
        title.className = "title";
        title.textContent = item.text || "";
        const sub = document.createElement("div");
        sub.className = "sub";
        sub.textContent = item.subText || "";
        if (idx < 9) {
          const hint = document.createElement("span");
          hint.className = "hint";
          hint.textContent = "âŒ˜" + (idx + 1);
          sub.appendChild(hint);
        }
        meta.appendChild(title);
        meta.appendChild(sub);
        row.appendChild(icon);
        row.appendChild(meta);
        row.addEventListener("mousedown", () => {
          active = idx;
          openActive();
        });
        listEl.appendChild(row);
      });
    }

    function filter() {
      const q = inputEl.value.trim().toLowerCase();
      if (!q) {
        filtered = items;
        active = 0;
        render();
        return;
      }
      filtered = items.filter(item => {
        const t = (item.text || "").toLowerCase();
        const s = (item.subText || "").toLowerCase();
        return t.includes(q) || s.includes(q);
      });
      active = 0;
      render();
    }

    function move(delta) {
      if (filtered.length === 0) return;
      active = (active + delta + Math.min(filtered.length, 50)) % Math.min(filtered.length, 50);
      render();
      const node = listEl.children[active];
      if (node) node.scrollIntoView({ block: "nearest" });
    }

    function openActive() {
      if (filtered.length === 0) return;
      const item = filtered[active];
      if (!item) return;
      if (mode === "ghostty") {
        if (item.command) {
          const url = "hammerspoon://spotlight-ghostty-run?cmd=" + encodeURIComponent(item.command);
          window.location = url;
        }
      } else {
        if (item.url) {
          const url = "hammerspoon://spotlight-edge-open?url=" + encodeURIComponent(item.url);
          window.location = url;
        }
      }
    }

    inputEl.addEventListener("input", filter);
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "ArrowDown") { e.preventDefault(); move(1); }
      else if (e.key === "ArrowUp") { e.preventDefault(); move(-1); }
      else if (e.key === "ArrowRight" || e.key === "ArrowLeft") {
        e.preventDefault();
        setMode(mode === "edge" ? "ghostty" : "edge");
      }
      else if (e.key === "Enter") { e.preventDefault(); openActive(); }
      else if (e.metaKey && /^[1-9]$/.test(e.key)) {
        e.preventDefault();
        const idx = parseInt(e.key, 10) - 1;
        if (filtered[idx]) {
          active = idx;
          openActive();
        }
      }
      else if (e.key === "Escape") {
        e.preventDefault();
        window.location = "hammerspoon://spotlight-close";
      }
    });

    modeEls.forEach(el => {
      el.addEventListener("mousedown", () => {
        setMode(el.dataset.mode);
      });
    });

    render();
    inputEl.focus();
  </script>
</body>
</html>
