<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    :root {
      --bg: rgba(255, 255, 255, 0.9);
      --border: rgba(0, 0, 0, 0.08);
      --text: #1c1c1e;
      --subtext: #6e6e73;
      --highlight: rgba(0, 122, 255, 0.18);
      --highlight-strong: #0a84ff;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", Helvetica, Arial, sans-serif;
      color: var(--text);
      height: 100%;
    }
    .panel {
      width: 100%;
      height: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 14px 10px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      backdrop-filter: blur(18px) saturate(140%);
    }
    .search {
      width: 100%;
      border: 0;
      outline: none;
      background: transparent;
      font-size: 18px;
      line-height: 24px;
      padding: 6px 8px;
    }
    .list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow: auto;
      padding-right: 4px;
    }
    .item {
      display: flex;
      flex-direction: column;
      gap: 2px;
      padding: 8px 10px;
      border-radius: 10px;
    }
    .item.active {
      background: var(--highlight);
      outline: 1px solid rgba(10, 132, 255, 0.3);
    }
    .title {
      font-size: 14px;
      line-height: 18px;
    }
    .sub {
      font-size: 12px;
      line-height: 16px;
      color: var(--subtext);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .hint {
      font-size: 14px;
      line-height: 18px;
      font-weight: 600;
      color: var(--text);
      opacity: 0.9;
      white-space: nowrap;
      margin-left: 12px;
    }
  </style>
</head>
<body>
  <div class="panel">
    <input id="search" class="search" type="text" placeholder="Search Edge Favorites" autofocus />
    <div id="list" class="list"></div>
  </div>

  <script>
    const items = __ITEMS__;
    const listEl = document.getElementById("list");
    const inputEl = document.getElementById("search");
    let filtered = items;
    let active = 0;

    function render() {
      listEl.innerHTML = "";
      if (filtered.length === 0) return;
      filtered.slice(0, 50).forEach((item, idx) => {
        const row = document.createElement("div");
        row.className = "item" + (idx === active ? " active" : "");
        const title = document.createElement("div");
        title.className = "title";
        title.textContent = item.text || "";
        const sub = document.createElement("div");
        sub.className = "sub";
        sub.textContent = item.subText || "";
        if (idx < 9) {
          const hint = document.createElement("span");
          hint.className = "hint";
          hint.textContent = "âŒ˜" + (idx + 1);
          sub.appendChild(hint);
        }
        row.appendChild(title);
        row.appendChild(sub);
        row.addEventListener("mousedown", () => {
          active = idx;
          openActive();
        });
        listEl.appendChild(row);
      });
    }

    function filter() {
      const q = inputEl.value.trim().toLowerCase();
      if (!q) {
        filtered = items;
        active = 0;
        render();
        return;
      }
      filtered = items.filter(item => {
        const t = (item.text || "").toLowerCase();
        const s = (item.subText || "").toLowerCase();
        return t.includes(q) || s.includes(q);
      });
      active = 0;
      render();
    }

    function move(delta) {
      if (filtered.length === 0) return;
      active = (active + delta + Math.min(filtered.length, 50)) % Math.min(filtered.length, 50);
      render();
      const node = listEl.children[active];
      if (node) node.scrollIntoView({ block: "nearest" });
    }

    function openActive() {
      if (filtered.length === 0) return;
      const item = filtered[active];
      if (item && item.url) {
        const url = "hammerspoon://edge-bookmarks-open?url=" + encodeURIComponent(item.url);
        window.location = url;
      }
    }

    inputEl.addEventListener("input", filter);
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "ArrowDown") { e.preventDefault(); move(1); }
      else if (e.key === "ArrowUp") { e.preventDefault(); move(-1); }
      else if (e.key === "Enter") { e.preventDefault(); openActive(); }
      else if (e.metaKey && /^[1-9]$/.test(e.key)) {
        e.preventDefault();
        const idx = parseInt(e.key, 10) - 1;
        if (filtered[idx]) {
          active = idx;
          openActive();
        }
      }
      else if (e.key === "Escape") {
        e.preventDefault();
        window.location = "hammerspoon://edge-bookmarks-close";
      }
    });

    window.addEventListener("keydown", (e) => {
      if (e.metaKey && /^[1-9]$/.test(e.key)) {
        e.preventDefault();
        const idx = parseInt(e.key, 10) - 1;
        if (filtered[idx]) {
          active = idx;
          openActive();
        }
      }
    });

    render();
    inputEl.focus();
  </script>
</body>
</html>
